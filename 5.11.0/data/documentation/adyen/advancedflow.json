{"abstract":[{"text":"If the simplified checkout flow starting with the ","type":"text"},{"type":"codeVoice","code":"\/sesssions"},{"type":"text","text":" call does not work for your needs,"},{"type":"text","text":" "},{"type":"text","text":"you can opt-in to use the previously default approach, that starts with the "},{"type":"codeVoice","code":"\/paymentMethods"},{"type":"text","text":" API call."},{"text":" ","type":"text"},{"type":"text","text":"In contrast to the simplified flow, your server will need to make two additional API calls, namely the"},{"text":" ","type":"text"},{"type":"codeVoice","code":"\/payments"},{"type":"text","text":" and "},{"code":"\/payments\/details","type":"codeVoice"},{"text":" calls when needed.","type":"text"}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/adyen\/advancedflow"]}],"primaryContentSections":[{"kind":"content","content":[{"type":"heading","level":2,"text":"Overview","anchor":"overview"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The Drop-in is initialized with the response of "},{"code":"\/paymentMethods","type":"codeVoice"},{"type":"text","text":", and provides everything you need to make an API call to "},{"type":"codeVoice","code":"\/payments"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"\/payments\/details"},{"text":".","type":"text"}]},{"text":"Presenting the Drop-in","level":2,"anchor":"Presenting-the-Drop-in","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"The Drop-in requires the response of the "},{"code":"\/paymentMethods","type":"codeVoice"},{"type":"text","text":" endpoint to be initialized. To pass the response to Drop-in, decode the response to the "},{"code":"PaymentMethods","type":"codeVoice"},{"text":" structure:","type":"text"}]},{"code":["let paymentMethods = try JSONDecoder().decode(PaymentMethods.self, from: response)"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"All Components need an "},{"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/APIContext","isActive":true,"type":"reference"},{"type":"text","text":". An instance of "},{"type":"codeVoice","code":"APIContext"},{"type":"text","text":" wraps your client key and an environment."},{"text":" ","type":"text"},{"text":"Please read more ","type":"text"},{"isActive":true,"identifier":"https:\/\/docs.adyen.com\/development-resources\/client-side-authentication","type":"reference"},{"type":"text","text":" about the client key and how to get."}]},{"inlineContent":[{"type":"text","text":"Use "},{"type":"codeVoice","code":"Environment.test"},{"type":"text","text":" during testing. When you’re ready to accept live payments, change the value to one of our "},{"isActive":true,"overridingTitle":"live environments","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/Environment","overridingTitleInlineContent":[{"type":"text","text":"live environments"}],"type":"reference"},{"type":"text","text":"."}],"type":"paragraph"},{"inlineContent":[{"type":"text","text":"We recommend creating a new context for each payment attempt."}],"type":"paragraph"},{"code":["var context: AdyenContext {","    let apiContext = try! APIContext(environment: componentsEnvironment, clientKey: clientKey)","    return AdyenContext(apiContext: apiContext,","                        payment: payment,","                        analyticsConfiguration: analyticsConfiguration)","}"],"type":"codeListing","syntax":"swift"},{"inlineContent":[{"type":"text","text":"Some payment methods need additional configuration. For example "},{"type":"reference","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/ApplePayComponent","isActive":true},{"type":"text","text":". These payment method specific configuration parameters can be set in an instance of "},{"code":"DropInComponent.Configuration","type":"codeVoice"},{"text":":","type":"text"}],"type":"paragraph"},{"code":["let summaryItems = [","                      PKPaymentSummaryItem(label: \"Item A\", amount: 75, type: .final),","                      PKPaymentSummaryItem(label: \"Item B\", amount: 25, type: .final),","                      PKPaymentSummaryItem(label: \"My Company\", amount: 100, type: .final)","                   ]","let applePayment = try ApplePayPayment(countryCode: \"US\",","                                       currencyCode: \"USD\",","                                       summaryItems: summaryItems)","","let dropInConfiguration = DropInComponent.Configuration()","dropInConfiguration.applePay = .init(payment: applePayment,","                                     merchantIdentifier: \"merchant.com.adyen.MY_MERCHANT_ID\")"],"syntax":"swift","type":"codeListing"},{"inlineContent":[{"type":"text","text":"Also for voucher payment methods like Doku variants, in order for the "},{"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/DokuComponent","type":"reference","isActive":true},{"type":"text","text":" to enable the shopper to save the voucher, access to the shopper photos is requested, so a suitable text need to be added to key  "},{"type":"codeVoice","code":"NSPhotoLibraryAddUsageDescription"},{"text":" in the application Info.plist.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"After serializing the payment methods and creating the configuration, the Drop-in is ready to be initialized. Assign a ","type":"text"},{"type":"codeVoice","code":"delegate"},{"type":"text","text":" and use the "},{"code":"viewController","type":"codeVoice"},{"text":" property to present the Drop-in on the screen:","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["let dropInComponent = DropInComponent(paymentMethods: paymentMethods,","                                      context: context,","                                      configuration: dropInConfiguration)","","self.dropInComponent = dropInComponent","dropInComponent.delegate = self","present(dropInComponent.viewController, animated: true)"]},{"level":3,"type":"heading","text":"Implementing DropInComponentDelegate","anchor":"Implementing-DropInComponentDelegate"},{"inlineContent":[{"type":"text","text":"To handle the results of the Drop-in, the following methods of "},{"type":"reference","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/DropInComponentDelegate","isActive":true},{"text":" should be implemented:","type":"text"}],"type":"paragraph"},{"code":["func didSubmit(_ data: PaymentComponentData, for paymentMethod: PaymentMethod, from component: DropInComponent)"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This method is invoked when the customer has selected a payment method and entered its payment details. The payment details can be read from "},{"type":"codeVoice","code":"data.paymentMethod"},{"type":"text","text":" and can be submitted as-is to "},{"type":"codeVoice","code":"\/payments"},{"type":"text","text":"."}]},{"code":["func didProvide(_ data: ActionComponentData, from component: DropInComponent)"],"type":"codeListing","syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"This method is invoked when additional details are provided by the Drop-in after the first call to "},{"type":"codeVoice","code":"\/payments"},{"type":"text","text":". This happens, for example, during the 3D Secure 2 authentication flow or any redirect flow. The additional details can be retrieved from "},{"type":"codeVoice","code":"data.details"},{"type":"text","text":" and can be submitted to "},{"code":"\/payments\/details","type":"codeVoice"},{"type":"text","text":"."}]},{"syntax":"swift","type":"codeListing","code":["func didFail(with error: Error, from component: DropInComponent)"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"This method is invoked when an error occurred during the use of the Drop-in. Dismiss the Drop-in’s view controller and display an error message."}]},{"syntax":"swift","type":"codeListing","code":["func didComplete(from component: DropInComponent)"]},{"inlineContent":[{"text":"This method is invoked when the action component finishes, without any further steps needed by the application, for example in case of voucher payment methods. The application just needs to dismiss the ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/DropInComponent"},{"type":"text","text":"."}],"type":"paragraph"},{"type":"codeListing","syntax":"swift","code":["func didCancel(component: PaymentComponent, from dropInComponent: DropInComponent)"]},{"type":"paragraph","inlineContent":[{"text":"This optional method is invoked when user closes a payment component managed by Drop-in.","type":"text"}]},{"syntax":"swift","code":["func didOpenExternalApplication(component: DropInComponent)"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"This optional method is invoked after a redirect to an external application has occurred."}],"type":"paragraph"},{"level":2,"text":"Handling an action","type":"heading","anchor":"Handling-an-action"},{"inlineContent":[{"type":"text","text":"When "},{"type":"codeVoice","code":"\/payments"},{"type":"text","text":" or "},{"type":"codeVoice","code":"\/payments\/details"},{"text":" responds with a non-final result and an ","type":"text"},{"type":"codeVoice","code":"action"},{"text":", you can use one of the following techniques.","type":"text"}],"type":"paragraph"},{"tabs":[{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"In case of Drop-in integration you must use built-in action handler on the current instance of "},{"isActive":true,"type":"reference","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/DropInComponent"},{"text":":","type":"text"}]},{"type":"codeListing","code":["let action = try JSONDecoder().decode(Action.self, from: actionData)","dropInComponent.handle(action)"],"syntax":"swift"}],"title":"Drop-in"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"In case of using individual components, create and persist an instance of "},{"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/AdyenActionComponent","type":"reference","isActive":true},{"text":":","type":"text"}]},{"type":"codeListing","code":["lazy var actionComponent: AdyenActionComponent = {","    let handler = AdyenActionComponent(context: context)","    handler.delegate = self","    handler.presentationDelegate = self","    return handler","}()"],"syntax":"swift"},{"inlineContent":[{"type":"text","text":"Then use it to handle the action:"}],"type":"paragraph"},{"code":["let action = try JSONDecoder().decode(Action.self, from: actionData)","actionComponent.handle(action)"],"type":"codeListing","syntax":"swift"}],"title":"Components"}],"type":"tabNavigator"},{"type":"heading","level":2,"anchor":"Receiving-redirect","text":"Receiving redirect"},{"type":"paragraph","inlineContent":[{"text":"In case the customer is redirected to an external URL or App, make sure to let the ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/RedirectComponent"},{"text":" know when the user returns to your app. Do this by implementing the following in your ","type":"text"},{"type":"codeVoice","code":"UIApplicationDelegate"},{"text":":","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["func application(_ app: UIApplication, open url: URL, options: [UIApplicationOpenURLOptionsKey: Any] = [:]) -> Bool {","    RedirectComponent.applicationDidOpen(from: url)","","    return true","}"]}]}],"sections":[],"kind":"article","hierarchy":{"paths":[["doc:\/\/Adyen\/documentation\/Adyen"]]},"metadata":{"role":"article","roleHeading":"Article","title":"Advanced flow integration guide","modules":[{"name":"Adyen"}]},"schemaVersion":{"patch":0,"major":0,"minor":3},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Adyen\/documentation\/Adyen\/AdvancedFlow"},"references":{"doc://Adyen/documentation/Adyen/AdyenActionComponent":{"role":"symbol","kind":"symbol","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/AdyenActionComponent","title":"AdyenActionComponent","navigatorTitle":[{"kind":"identifier","text":"AdyenActionComponent"}],"abstract":[{"type":"text","text":"An action handler component to perform any supported action out of the box."}],"type":"topic","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"AdyenActionComponent","kind":"identifier"}],"url":"\/documentation\/adyen\/adyenactioncomponent"},"doc://Adyen/documentation/Adyen/ApplePayComponent":{"type":"topic","role":"symbol","url":"\/documentation\/adyen\/applepaycomponent","kind":"symbol","fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"ApplePayComponent"}],"navigatorTitle":[{"kind":"identifier","text":"ApplePayComponent"}],"abstract":[{"type":"text","text":"A component that handles Apple Pay payments."}],"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/ApplePayComponent","title":"ApplePayComponent"},"https://docs.adyen.com/development-resources/client-side-authentication":{"url":"https:\/\/docs.adyen.com\/development-resources\/client-side-authentication","titleInlineContent":[{"type":"text","text":"here"}],"identifier":"https:\/\/docs.adyen.com\/development-resources\/client-side-authentication","type":"link","title":"here"},"doc://Adyen/documentation/Adyen":{"type":"topic","role":"collection","identifier":"doc:\/\/Adyen\/documentation\/Adyen","kind":"symbol","abstract":[],"title":"Adyen","url":"\/documentation\/adyen"},"doc://Adyen/documentation/Adyen/DropInComponentDelegate":{"abstract":[{"type":"text","text":"Defines the methods a delegate of the drop in component should implement."}],"role":"symbol","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/DropInComponentDelegate","type":"topic","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"DropInComponentDelegate"}],"title":"DropInComponentDelegate","url":"\/documentation\/adyen\/dropincomponentdelegate","fragments":[{"kind":"keyword","text":"protocol"},{"text":" ","kind":"text"},{"kind":"identifier","text":"DropInComponentDelegate"}]},"doc://Adyen/documentation/Adyen/RedirectComponent":{"url":"\/documentation\/adyen\/redirectcomponent","title":"RedirectComponent","role":"symbol","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"RedirectComponent"}],"fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"text":"RedirectComponent","kind":"identifier"}],"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/RedirectComponent","type":"topic","abstract":[{"text":"Handles any redirect Url whether its a web url, an App custom scheme url, or an app universal link.","type":"text"}]},"doc://Adyen/documentation/Adyen/DropInComponent":{"url":"\/documentation\/adyen\/dropincomponent","title":"DropInComponent","role":"symbol","kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"DropInComponent"}],"fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"DropInComponent","kind":"identifier"}],"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/DropInComponent","type":"topic","abstract":[{"type":"text","text":"A component that handles the entire flow of payment selection and payment details entry."}]},"doc://Adyen/documentation/Adyen/Environment":{"kind":"symbol","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/Environment","title":"Environment","abstract":[{"text":"Struct that defines the environment to retrieve resources from.","type":"text"}],"url":"\/documentation\/adyen\/environment","role":"symbol","fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"Environment"}],"navigatorTitle":[{"text":"Environment","kind":"identifier"}],"type":"topic"},"doc://Adyen/documentation/Adyen/DokuComponent":{"navigatorTitle":[{"kind":"identifier","text":"DokuComponent"}],"kind":"symbol","url":"\/documentation\/adyen\/dokucomponent","title":"DokuComponent","identifier":"doc:\/\/Adyen\/documentation\/Adyen\/DokuComponent","abstract":[{"text":"A component that provides a form for Doku Wallet, Doku Alfamart, and Doku Indomaret  payments.","type":"text"}],"type":"topic","role":"symbol","fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"text":"DokuComponent","kind":"identifier"}]},"doc://Adyen/documentation/Adyen/APIContext":{"identifier":"doc:\/\/Adyen\/documentation\/Adyen\/APIContext","abstract":[{"type":"text","text":"Struct that defines API context for retrieving internal resources."}],"role":"symbol","navigatorTitle":[{"kind":"identifier","text":"APIContext"}],"title":"APIContext","url":"\/documentation\/adyen\/apicontext","type":"topic","fragments":[{"kind":"keyword","text":"struct"},{"text":" ","kind":"text"},{"kind":"identifier","text":"APIContext"}],"kind":"symbol"}}}